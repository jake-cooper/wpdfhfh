(function($){$.fn.sowSetupForm=function(){return $(this).each(function(i,el){var $el=$(el);if($el.is('.siteorigin-widget-form-main')){if($el.data('sow-form-setup')==true)return true;if($('body').hasClass('widgets-php')&&!$el.is(':visible'))return true;}
var $fields=$el.find('> .siteorigin-widget-field');$el.find('> .siteorigin-widget-field .siteorigin-widget-input').each(function(i,input){if($(input).data('original-name')==null){$(input).data('original-name',$(input).attr('name'));}});$fields.find('> .siteorigin-widget-field-repeater').sowSetupRepeater();$el.find('.siteorigin-widget-field-repeater-item').sowSetupRepeaterActions();$fields.find('> .siteorigin-widget-input-color').wpColorPicker().closest('.siteorigin-widget-field').find('a').click(function(){if(typeof $.fn.dialog!='undefined'){$(this).closest('.panel-dialog').dialog("option","position","center");}});$fields.find('> .siteorigin-widget-input').change(function(){var inputs=$(this).closest('.siteorigin-widget-form').find('.siteorigin-widget-input').clone();var preview=$(this).closest('.siteorigin-widget-form').find('.siteorigin-widget-preview');if(preview.length==0)return;var form=$('<form />').attr({'target':preview.attr('name'),'method':'POST','action':ajaxurl+"?action=siteorigin_widget_preview&class="+$(this).closest('.siteorigin-widget-form').data('class')}).append(inputs).submit();});$fields.find('> .media-field-wrapper a.media-upload-button').click(function(event){var $$=$(this);var $c=$(this).closest('.siteorigin-widget-field');var frame=$(this).data('frame');if(frame){frame.open();return false;}
frame=wp.media({title:$$.data('choose'),library:{type:$$.data('library').split(',').map(function(v){return v.trim()})},button:{text:$$.data('update'),close:false}});$$.data('frame',frame);frame.on('select',function(){var attachment=frame.state().get('selection').first().attributes;$c.find('.current .title').html(attachment.title);$c.find('input[type=hidden]').val(attachment.id);if(typeof attachment.sizes!='undefined'){if(typeof attachment.sizes.thumbnail!='undefined')
$c.find('.current .thumbnail').attr('src',attachment.sizes.thumbnail.url).fadeIn();else
$c.find('.current .thumbnail').attr('src',attachment.sizes.full.url).fadeIn();}
else{$c.find('.current .thumbnail').attr('src',attachment.icon).fadeIn();}
frame.close();});frame.open();return false;});$fields.find('> .media-field-wrapper').mouseenter(function(){if($(this).closest('.siteorigin-widget-field').find('input[type=hidden]').val()!='')$(this).find('.media-remove-button').fadeIn('fast');}).mouseleave(function(){$(this).find('.media-remove-button').fadeOut('fast');})
$fields.find('> .media-field-wrapper .current').mouseenter(function(){var t=$(this).find('.title');if(t.html()!=''){t.fadeIn('fast');}}).mouseleave(function(){$(this).find('.title').clearQueue().fadeOut('fast');})
$fields.find('> .media-field-wrapper a.media-remove-button').click(function(){var $$=$(this).closest('.siteorigin-widget-field');$$.find('.current .title').html('');$$.find('input[type=hidden]').val('');$$.find('.current .thumbnail').fadeOut('fast');$(this).fadeOut('fast');});$el.trigger('sowsetupform').data('sow-form-setup',true);$el.find('.siteorigin-widget-field-repeater-item').trigger('updateFieldPositions');});};$.fn.sowSetupRepeater=function(){return $(this).each(function(i,el){var $el=$(el);var $items=$el.find('.siteorigin-widget-field-repeater-items');var name=$el.data('repeater-name');$items.bind('updateFieldPositions',function(){var $$=$(this);$$.find('> .siteorigin-widget-field-repeater-item').each(function(i,el){$(el).find('.siteorigin-widget-input').each(function(j,input){var pos=$(input).data('repeater-positions');if(typeof pos=='undefined'){pos={};}
pos[name]=i;$(input).data('repeater-positions',pos);});});$$.find('.siteorigin-widget-input').each(function(i,input){var pos=$(input).data('repeater-positions');var $in=$(input);if(typeof pos!='undefined'){var newName=$in.data('original-name');if(typeof newName=='undefined'){$in.data('original-name',$in.attr('name'));newName=$in.attr('name');}
for(var k in pos){newName=newName.replace('#'+k+'#',pos[k]);}
$(input).attr('name',newName);}});});$items.sortable({handle:'.siteorigin-widget-field-repeater-item-top',items:'> .siteorigin-widget-field-repeater-item',update:function(){$items.trigger('updateFieldPositions');}});$items.trigger('updateFieldPositions');$el.find('> .siteorigin-widget-field-repeater-add').disableSelection().click(function(e){e.preventDefault();$el.closest('.siteorigin-widget-field-repeater').sowAddRepeaterItem().find('> .siteorigin-widget-field-repeater-items').slideDown('fast');if(typeof $.fn.dialog!='undefined'){$(this).closest('.panel-dialog').dialog("option","position","center");}});$el.find('> .siteorigin-widget-field-repeater-top > .siteorigin-widget-field-repeater-expend').click(function(e){e.preventDefault();$el.closest('.siteorigin-widget-field-repeater').find('> .siteorigin-widget-field-repeater-items').slideToggle('fast');});});};$.fn.sowAddRepeaterItem=function(){return $(this).each(function(i,el){var $el=$(el);var theClass=$el.closest('.siteorigin-widget-form').data('class');var formClass=$el.closest('.siteorigin-widget-form').data('class');var item=$('<div class="siteorigin-widget-field-repeater-item" />').append($('<div class="siteorigin-widget-field-repeater-item-top" />').append($('<div class="siteorigin-widget-field-repeater-item-expand" />')).append($('<div class="siteorigin-widget-field-repeater-item-remove" />')).append($('<h4 />').html($el.data('item-name')))).append($('<div class="siteorigin-widget-field-repeater-item-form" />').html(window.sow_repeater_html[formClass][$el.data('repeater-name')])).sowSetupRepeaterActions();$el.find('> .siteorigin-widget-field-repeater-items').append(item).sortable("refresh").trigger('updateFieldPositions');item.hide().slideDown('fast');});};$.fn.sowSetupRepeaterActions=function(){return $(this).each(function(i,el){var $el=$(el);if(typeof $el.data('sowrepeater-actions-setup')=='undefined'){var top=$el.find('> .siteorigin-widget-field-repeater-item-top');top.find('.siteorigin-widget-field-repeater-item-expand').click(function(e){e.preventDefault();$(this).closest('.siteorigin-widget-field-repeater-item').find('.siteorigin-widget-field-repeater-item-form').eq(0).slideToggle('fast',function(){if(typeof $.fn.dialog!='undefined'){$(this).closest('.panel-dialog').dialog("option","position","center");}});});top.find('.siteorigin-widget-field-repeater-item-remove').click(function(e){e.preventDefault();if(confirm(soWidgets.sure)){var $s=$(this).closest('.siteorigin-widget-field-repeater-items');$(this).closest('.siteorigin-widget-field-repeater-item').slideUp('fast',function(){$(this).remove();$s.sortable("refresh").trigger('updateFieldPositions');});}});$el.find('> .siteorigin-widget-field-repeater-item-form').sowSetupForm();$el.data('sowrepeater-actions-setup',true);}});}
$('.widgets-holder-wrap').on('click','.widget:has(.siteorigin-widget-form-main) .widget-top',function(){var $$=$(this).closest('.widget').find('.siteorigin-widget-form-main');setTimeout(function(){$$.sowSetupForm();},200);});$(document).on('dialogopen',function(e){$(e.target).find('.siteorigin-widget-form-main').sowSetupForm();});})(jQuery);